name: UiPath Publish to Orchestrator

on:
  push:
    branches:
      - main

jobs:
  publish-uipath:
    runs-on: windows-latest

    env:
      ORCH_URL: ${{ secrets.UIPATH_ORCHESTRATOR_URL }}
      ORCH_CLIENT_ID: ${{ secrets.UIPATH_CLIENT_ID }}
      ORCH_CLIENT_SECRET: ${{ secrets.UIPATH_CLIENT_SECRET }}
      ORCH_TENANT: ${{ secrets.UIPATH_TENANT_NAME }}
      PROJECT_PATH: ./TestAutomation  # Your UiPath project folder path

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up .NET Tool Manifest
        run: |
          dotnet new tool-manifest
          dotnet tool install UiPath.CLI --version 23.10.8647 --add-source https://www.myget.org/F/uipath-dev/api/v3/index.json

      - name: Display UiPath CLI Version
        run: dotnet tool run uipath --version

      - name: Publish Project to Orchestrator
        run: |
          dotnet tool run uipath project push `
            --project-path "${{ env.PROJECT_PATH }}" `
            --orchestratorUrl "${{ env.ORCH_URL }}" `
            --clientId "${{ env.ORCH_CLIENT_ID }}" `
            --clientSecret "${{ env.ORCH_CLIENT_SECRET }}" `
            --tenant "${{ env.ORCH_TENANT }}"
